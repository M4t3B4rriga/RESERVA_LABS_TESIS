-- Modificando la tabla T_MSUSUARIO para agregar el campo ROL
ALTER TABLE T_MSUSUARIO
ADD ROL ENUM('Estudiante', 'Administrativo', 'Profesor') NOT NULL DEFAULT 'Estudiante';

-- Creando la tabla T_REGISTRO_SOLICITUD para gestionar solicitudes de registro
CREATE TABLE T_REGISTRO_SOLICITUD (
    PK_REGISTRO_SOLICITUD INT AUTO_INCREMENT PRIMARY KEY,
    PK_TMCPERSONA_INTERNA INT NOT NULL,
    USU_NOMBRE VARCHAR(30) NOT NULL,
    XEUSU_PASWD VARCHAR(256) NOT NULL,
    PEI_NOMBRE VARCHAR(50) NOT NULL,
    PEI_APELLIDO_PATERNO VARCHAR(50) NOT NULL,
    PEI_APELLIDO_MATERNO VARCHAR(50),
    PEI_EMAIL_INSTITUCIONAL VARCHAR(100) NOT NULL,
    ROL ENUM('Estudiante', 'Administrativo', 'Profesor') NOT NULL,
    ESTADO ENUM('Pendiente', 'Aceptado', 'Rechazado') NOT NULL DEFAULT 'Pendiente',
    FECHA_SOLICITUD DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FECHA_RESPUESTA DATETIME,
    COMENTARIO_ADMIN VARCHAR(255),
    FOREIGN KEY (PK_TMCPERSONA_INTERNA) REFERENCES T_MCPERSONA_INTERNA(PK_TMCPERSONA_INTERNA)
);


-- Insertar ítem de menú para Solicitudes
INSERT INTO T_MSITEM_MENU (IME_NOMBRE, IME_URL, IME_POSICION, IME_ICONO, ESTADO)
VALUES ('Solicitudes de Registro', '/solicitudes', 13, '', 1);

-- Asignar permiso al rol Admin Root (PK_TMSROL = 3)
INSERT INTO T_MSPERMISO (PK_TMSROL, PK_TMS_ITEM_MENU, PK_TMSSUBITEM_MENU, PK_TMSSUB_SUBITEM_MENU, PK_TMSFUNCIONALIDAD, PER_FECHA_ASIGNACION, ESTADO)
VALUES (3, 13, NULL, NULL, NULL, NOW(), 1);


Agregar la ruta:
-- Insertar ítem de menú para Solicitudes
INSERT INTO T_MSITEM_MENU (IME_NOMBRE, IME_URL, IME_POSICION, IME_ICONO, ESTADO)
VALUES ('Solicitudes de Registro', '/solicitudes', 13, '', 1);

SET SQL_SAFE_UPDATES = 0;
UPDATE T_MSITEM_MENU 
SET IME_URL = '/solicitudes' 
WHERE IME_NOMBRE = 'Solicitudes de Registro';
SET SQL_SAFE_UPDATES = 1;

Verificación:
-- Verificar si PK_TMS_ITEM_MENU = 12 está en T_MSSUBITEM_MENU
SELECT * FROM T_MSSUBITEM_MENU WHERE PK_TMS_ITEM_MENU = 12;

-- confimacion de los permisos
SELECT * FROM T_MSITEM_MENU WHERE PK_TMS_ITEM_MENU = 12;
SELECT * FROM T_MSPERMISO WHERE PK_TMSROL = 3 AND PK_TMS_ITEM_MENU = 12;

ejemplos:

INSERT INTO T_MCPERSONA_INTERNA (PEI_NOMBRE, PEI_APELLIDO_PATERNO, PEI_APELLIDO_MATERNO, PEI_CARNET_ID, PEI_EMAIL_INSTITUCIONAL)
VALUES ('Juan', 'Pérez', 'Gómez', 'L12345678', 'juan.perez@espe.edu.ec');

INSERT INTO T_REGISTRO_SOLICITUD (PK_TMCPERSONA_INTERNA, USU_NOMBRE, XEUSU_PASWD, PEI_NOMBRE, PEI_APELLIDO_PATERNO, PEI_APELLIDO_MATERNO, PEI_EMAIL_INSTITUCIONAL, ROL, ESTADO)
VALUES (LAST_INSERT_ID(), 'jperez', 'hashed_password', 'Juan', 'Pérez', 'Gómez', 'juan.perez@espe.edu.ec', 'Estudiante', 'Pendiente');
